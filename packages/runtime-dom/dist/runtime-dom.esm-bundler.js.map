{"version":3,"file":"runtime-dom.esm-bundler.js","sources":["../../shared/src/index.ts","../src/nodeOps.ts","../src/modules/class.ts","../src/modules/style.ts","../src/modules/attr.ts","../src/modules/event.ts","../src/patchProp.ts","../../runtime-core/src/render.ts","../src/index.ts"],"sourcesContent":["export const isObject = (param) => typeof param === 'object' && param!='null'\r\n\r\nexport const extend = Object.assign\r\nexport const isArray = Array.isArray\r\nexport const isFunction = (val) => typeof val === 'function'\r\nexport const isString = (val) => typeof val === 'string'\r\nexport const isNumber = (val) => typeof val === 'number'\r\n\r\nconst hasOwnProperty = Object.prototype.hasOwnProperty\r\nexport const hasOwn = (\r\n  val: object,\r\n  key: string | symbol\r\n): key is keyof typeof val => hasOwnProperty.call(val, key)\r\n \r\nexport const isIntegerKey = (key: unknown) =>\r\n  isString(key) &&\r\n  key !== 'NaN' &&\r\n  key[0] !== '-' &&\r\n  '' + parseInt(key as string, 10) === key\r\n\r\n  export const hasChange = (val,oldVal) => {\r\n    return val!=oldVal\r\n  }","// 操作节点 增删改查\r\nexport const nodeOps = {\r\n  // vue会根据不同平台创建元素\r\n  createElement: tagName => document.createElement(tagName),\r\n  remove: child => {\r\n    let parent = child.parentNode;\r\n    if (parent) {\r\n      parent.remove(child)\r\n    }\r\n  },\r\n  insert(child,parent,ancher = null){\r\n    parent.insertBefore(child,ancher) // ancher=null，appendChild\r\n  },\r\n  querySelector(selector) {\r\n    return document.querySelector(selector)\r\n  },\r\n  setElementText: (el,text) => el.textContent = text,\r\n  createText: text => document.createTextNode(text),\r\n  setText: (node,text) => node.nodeValue = text,\r\n}","export const patchClass = (el, value) => {\r\n  if(value === null) {\r\n    return value = ''\r\n  }\r\n  el.className = value\r\n}","export const patchStyle = (el,prev, next) => {\r\n  const style = el.style\r\n  if(next === null) {\r\n    el.removeAttribute('style')\r\n  } else {\r\n    // 老的有， 新的没有\r\n    if(prev) {\r\n      for (let key in prev) {\r\n        if (next[key] === null) {\r\n          style[key] = ''\r\n        }\r\n      }\r\n    }\r\n    // 新的有，老的没有 => 把新的赋值给老的\r\n    for (let key in next) {\r\n      style[key] = next[key]\r\n    }\r\n  }\r\n}","// 自定义属性\r\nexport const patchAttr = (el,key,value) => {\r\n  if(value === null) {\r\n    el.removeAttribute(key)\r\n  } else {\r\n    el.setAttribute(key,value)\r\n  }\r\n}","\r\n// 事件 @click=\"fn\" @click=\"fn1\"\r\n// 一个元素的绑定事件 addEventListener ,不能直接覆盖\r\n// 缓存（click:fn)\r\nexport const patchEvent = (el,key,value) => {\r\n  // 1.对函数缓存\r\n  const invokers = el._vei || (el._vei = {})\r\n  const exists = invokers[key]\r\n  if (exists && value) {\r\n    exists.value = value; // 指向最新的事件\r\n  } else {\r\n    // 获取事件名称 1）新的有 2）新的没有\r\n    const eventName = key.slice(2).toLowerCase()\r\n    if (value) {\r\n      let invoker = invokers[eventName] = createInvoker(value)\r\n      el.addEventListener(eventName, invoker)\r\n    } else {// 没有 删除\r\n      el.removeEventListener(eventName, exists)\r\n      invokers[eventName] = undefined;\r\n    }\r\n  }\r\n}\r\nfunction createInvoker(value) {\r\n  const fn = (e) => {\r\n    fn.value(e)\r\n  }\r\n  fn.value = value;\r\n  return fn;\r\n}","// 策略模式 div class style a=1 onClick { style: { color: 'red' }} { style: { background: 'red' }}\r\nimport{ patchClass } from './modules/class'\r\nimport{ patchStyle } from './modules/style'\r\nimport{ patchAttr } from './modules/attr'\r\nimport { patchEvent } from './modules/event'\r\n\r\nexport const patchProps = (el,key,prevValue, nextValue) => {\r\n  switch(key) {\r\n    case 'class':\r\n      patchClass(el, nextValue)\r\n      break;\r\n    case 'style':\r\n      patchStyle(el,prevValue, nextValue)\r\n      break;\r\n      default: // 方法\r\n        if (/^on[^a-z]/.test(key)) { // 是不是事件 @onclick\r\n          patchEvent(el, key, nextValue)\r\n        } else {\r\n          patchAttr(el, key, nextValue)\r\n        }\r\n        break;\r\n  }\r\n}","export function createRenderer(renderOptionDom) {\r\n  return {\r\n    createApp(rootComp, rootProps) {\r\n      let app = {\r\n        mount(container) {\r\n          console.log(rootComp, rootProps, container, renderOptionDom)\r\n        }\r\n      }\r\n      return app\r\n    }\r\n  }\r\n}","// 操作dom 1)节点 2）属性\r\nimport { extend } from \"@vue/shared\"\r\nimport { nodeOps } from './nodeOps'\r\nimport { patchProps } from './patchProp'\r\nimport { createRenderer } from '@vue/runtime-core'\r\n\r\nconst renderOptionDom = extend({patchProps}, nodeOps)\r\nexport const createApp = (rootComp, rootProps) => {\r\n  // 不同平台操作dom不同\r\n  let app: any = createRenderer(renderOptionDom).createApp(rootComp, rootProps)\r\n  let { mount } = app;\r\n  app.mount = (container) => {\r\n    container = nodeOps.querySelector(container)\r\n    container.innerHTML = ''\r\n    // dom元素挂载\r\n    mount(container)\r\n  }\r\nreturn app\r\n}\r\n// export {\r\n//   renderOptionDom\r\n// }"],"names":[],"mappings":"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"}