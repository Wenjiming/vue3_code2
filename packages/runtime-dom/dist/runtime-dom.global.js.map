{"version":3,"file":"runtime-dom.global.js","sources":["../../shared/src/index.ts","../src/nodeOps.ts","../src/modules/class.ts","../src/modules/style.ts","../src/modules/attr.ts","../src/modules/event.ts","../src/patchProp.ts","../src/index.ts"],"sourcesContent":["export const isObject = (param) => typeof param === 'object' && param!='null'\r\n\r\nexport const extend = Object.assign\r\nexport const isArray = Array.isArray\r\nexport const isFunction = (val) => typeof val === 'function'\r\nexport const isString = (val) => typeof val === 'string'\r\nexport const isNumber = (val) => typeof val === 'number'\r\n\r\nconst hasOwnProperty = Object.prototype.hasOwnProperty\r\nexport const hasOwn = (\r\n  val: object,\r\n  key: string | symbol\r\n): key is keyof typeof val => hasOwnProperty.call(val, key)\r\n \r\nexport const isIntegerKey = (key: unknown) =>\r\n  isString(key) &&\r\n  key !== 'NaN' &&\r\n  key[0] !== '-' &&\r\n  '' + parseInt(key as string, 10) === key\r\n\r\n  export const hasChange = (val,oldVal) => {\r\n    return val!=oldVal\r\n  }","// 操作节点 增删改查\r\nexport const nodeOps = {\r\n  // vue会根据不同平台创建元素\r\n  createElement: tagName => document.createElement(tagName),\r\n  remove: child => {\r\n    let parent = child.parentNode;\r\n    if (parent) {\r\n      parent.remove(child)\r\n    }\r\n  },\r\n  insert(child,parent,ancher = null){\r\n    parent.insertBefore(child,ancher) // ancher=null，appendChild\r\n  },\r\n  querySelector(selector) {\r\n    return document.querySelector(selector)\r\n  },\r\n  setElementText: (el,text) => el.textContent = text,\r\n  createText: text => document.createTextNode(text),\r\n  setText: (node,text) => node.nodeValue = text,\r\n}","export const patchClass = (el, value) => {\r\n  if(value === null) {\r\n    return value = ''\r\n  }\r\n  el.className = value\r\n}","export const patchStyle = (el,prev, next) => {\r\n  const style = el.style\r\n  if(next === null) {\r\n    el.removeAttribute('style')\r\n  } else {\r\n    // 老的有， 新的没有\r\n    if(prev) {\r\n      for (let key in prev) {\r\n        if (next[key] === null) {\r\n          style[key] = ''\r\n        }\r\n      }\r\n    }\r\n    // 新的有，老的没有 => 把新的赋值给老的\r\n    for (let key in next) {\r\n      style[key] = next[key]\r\n    }\r\n  }\r\n}","// 自定义属性\r\nexport const patchAttr = (el,key,value) => {\r\n  if(value === null) {\r\n    el.removeAttribute(key)\r\n  } else {\r\n    el.setAttribute(key,value)\r\n  }\r\n}","\r\n// 事件 @click=\"fn\" @click=\"fn1\"\r\n// 一个元素的绑定事件 addEventListener ,不能直接覆盖\r\n// 缓存（click:fn)\r\nexport const patchEvent = (el,key,value) => {\r\n  // 1.对函数缓存\r\n  const invokers = el._vei || (el._vei = {})\r\n  const exists = invokers[key]\r\n  if (exists && value) {\r\n    exists.value = value; // 指向最新的事件\r\n  } else {\r\n    // 获取事件名称 1）新的有 2）新的没有\r\n    const eventName = key.slice(2).toLowerCase()\r\n    if (value) {\r\n      let invoker = invokers[eventName] = createInvoker(value)\r\n      el.addEventListener(eventName, invoker)\r\n    } else {// 没有 删除\r\n      el.removeEventListener(eventName, exists)\r\n      invokers[eventName] = undefined;\r\n    }\r\n  }\r\n}\r\nfunction createInvoker(value) {\r\n  const fn = (e) => {\r\n    fn.value(e)\r\n  }\r\n  fn.value = value;\r\n  return fn;\r\n}","// 策略模式 div class style a=1 onClick { style: { color: 'red' }} { style: { background: 'red' }}\r\nimport{ patchClass } from './modules/class'\r\nimport{ patchStyle } from './modules/style'\r\nimport{ patchAttr } from './modules/attr'\r\nimport { patchEvent } from './modules/event'\r\n\r\nexport const patchProps = (el,key,prevValue, nextValue) => {\r\n  switch(key) {\r\n    case 'class':\r\n      patchClass(el, nextValue)\r\n      break;\r\n    case 'style':\r\n      patchStyle(el,prevValue, nextValue)\r\n      break;\r\n      default: // 方法\r\n        if (/^on[^a-z]/.test(key)) { // 是不是事件 @onclick\r\n          patchEvent(el, key, nextValue)\r\n        } else {\r\n          patchAttr(el, key, nextValue)\r\n        }\r\n        break;\r\n  }\r\n}","// 操作dom 1)节点 2）属性\r\nimport { extend } from \"@vue/shared\"\r\nimport { nodeOps } from './nodeOps'\r\nimport { patchProps } from './patchProp'\r\n\r\nfunction createRenderer(renderOptionDom) {\r\n  return {\r\n    createApp(rootComp, rootProps) {\r\n      let app = {\r\n        mount(container) {\r\n          \r\n        }\r\n      }\r\n      return app\r\n    }\r\n  }\r\n}\r\nconst renderOptionDom = extend({patchProps}, nodeOps)\r\nexport const createApp = (rootComp, rootProps) => {\r\n  // 不同平台操作dom不同\r\n  let app: any = createRenderer(renderOptionDom).createApp(rootComp, rootProps)\r\n  let { mount } = app;\r\n  app.mount = (container) => {\r\n    container = nodeOps.querySelector(container)\r\n    container.innerHTML = ''\r\n    // dom元素挂载\r\n    mount(container)\r\n  }\r\nreturn app\r\n}\r\n// export {\r\n//   renderOptionDom\r\n// }"],"names":[],"mappings":"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"}