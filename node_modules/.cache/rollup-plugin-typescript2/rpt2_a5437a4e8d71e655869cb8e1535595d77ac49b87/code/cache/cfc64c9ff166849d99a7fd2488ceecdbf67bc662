{"code":"export function effect(fn, options = {}) {\n    const effect = createReactEffect(fn, options);\n    if (!options.lazy) {\n        effect();\n    }\n    return effect;\n}\nlet uid = 0;\nlet activeEffect; // 保存当前的effect\nlet effectstack = [];\nfunction createReactEffect(fn, options) {\n    const effect = function reactiveEffect() {\n        if (!effectstack.includes(effect)) { // ？？\n            try {\n                effectstack.push(effect);\n                activeEffect = effect;\n                fn();\n            }\n            finally {\n                effectstack.pop();\n                activeEffect = effectstack[effectstack.length - 1];\n            }\n        }\n    };\n    effect.uid = uid++; // 区别不同effect\n    effect._isEffect = true; // 区别effect是不是响应式的effect\n    effect.raw = fn; // 保存依赖回调\n    effect.options = options; // 保存传入属性\n    return effect;\n}\nlet targetMap = new WeakMap();\nexport function track(target, type, key) {\n    // key activeEffect 一一对应\n    /**\n     * WeakMap(\n     * {\n     *    target: Map({\n     *      key: Set({ effect1, effect2 })\n     *    })\n     * }\n     * )\n     */\n    // { name : '' }\n    // 1）定义未使用 2）非响应式数据(访问state.age)\n    if (activeEffect === undefined) {\n        return;\n    }\n    let depMap = targetMap.get(target);\n    if (!depMap) {\n        targetMap.set(target, (depMap = new Map));\n    }\n    let dep = depMap.get(key);\n    if (!dep) {\n        depMap.set(key, (dep = new Set));\n    }\n    if (!dep.has(activeEffect)) {\n        dep.add(activeEffect);\n    }\n    console.log(targetMap);\n}\n/** effect可以树形结构，增加栈处理\n * 保存问题，activeEffect只保存了当前的\n * effect(()=>{ // effect1\n  //收集的 effect1\n    state .name\n    effect(()=> { //effect2\n      state.age//effect2\n    })\n    state.age // effect1\n  })\n *\n */\nexport function trigger(target, type, key, value, oldValue) {\n    console.log(target, type, key, value, oldValue, 'target, type,key, value, oldValue');\n}\n//# sourceMappingURL=effect.js.map","references":[],"map":"{\"version\":3,\"file\":\"effect.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../packages/reactivity/src/effect.ts\"],\"names\":[],\"mappings\":\"AAAA,MAAM,UAAU,MAAM,CAAC,EAAE,EAAE,UAAe,EAAE;IAC1C,MAAM,MAAM,GAAG,iBAAiB,CAAC,EAAE,EAAE,OAAO,CAAC,CAAA;IAE7C,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE;QACjB,MAAM,EAAE,CAAA;KACT;IACD,OAAO,MAAM,CAAA;AACf,CAAC;AACD,IAAI,GAAG,GAAG,CAAC,CAAC;AACZ,IAAI,YAAY,CAAC,CAAC,cAAc;AAChC,IAAI,WAAW,GAAG,EAAE,CAAA;AACpB,SAAS,iBAAiB,CAAC,EAAE,EAAE,OAAO;IACpC,MAAM,MAAM,GAAG,SAAS,cAAc;QACpC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE,EAAE,KAAK;YACxC,IAAI;gBACF,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;gBACxB,YAAY,GAAG,MAAM,CAAA;gBACrB,EAAE,EAAE,CAAA;aACL;oBAAS;gBACR,WAAW,CAAC,GAAG,EAAE,CAAA;gBACjB,YAAY,GAAG,WAAW,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,CAAA;aACnD;SACF;IACH,CAAC,CAAA;IACD,MAAM,CAAC,GAAG,GAAG,GAAG,EAAE,CAAC,CAAC,aAAa;IACjC,MAAM,CAAC,SAAS,GAAG,IAAI,CAAA,CAAC,wBAAwB;IAChD,MAAM,CAAC,GAAG,GAAG,EAAE,CAAC,CAAC,SAAS;IAC1B,MAAM,CAAC,OAAO,GAAG,OAAO,CAAC,CAAC,SAAS;IACnC,OAAO,MAAM,CAAA;AACf,CAAC;AAED,IAAI,SAAS,GAAG,IAAI,OAAO,EAAE,CAAA;AAC7B,MAAM,UAAU,KAAK,CAAC,MAAM,EAAE,IAAI,EAAE,GAAG;IACrC,wBAAwB;IACxB;;;;;;;;OAQG;IAEH,gBAAgB;IAChB,gCAAgC;IAChC,IAAI,YAAY,KAAK,SAAS,EAAE;QAC9B,OAAM;KACP;IACD,IAAI,MAAM,GAAG,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;IAClC,IAAI,CAAC,MAAM,EAAE;QACX,SAAS,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,MAAM,GAAG,IAAI,GAAG,CAAC,CAAC,CAAA;KAC1C;IACD,IAAI,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;IACzB,IAAI,CAAC,GAAG,EAAE;QACR,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,GAAG,GAAG,IAAI,GAAG,CAAC,CAAC,CAAA;KACjC;IACD,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,YAAY,CAAC,EAAE;QAC1B,GAAG,CAAC,GAAG,CAAC,YAAY,CAAC,CAAA;KACtB;IACD,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAA;AACxB,CAAC;AAED;;;;;;;;;;;GAWG;AAEH,MAAM,UAAU,OAAO,CAAC,MAAM,EAAE,IAAI,EAAC,GAAG,EAAE,KAAM,EAAE,QAAS;IAC3D,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,EAAC,GAAG,EAAE,KAAK,EAAE,QAAQ,EAAE,mCAAmC,CAAC,CAAA;AACnF,CAAC\"}"}
